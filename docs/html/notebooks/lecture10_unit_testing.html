

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>10) Writing unit tests and running from anywhere on your machine &#8212; CHE 696: On-Ramp to Data Science 0.1 documentation</title>
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11) Automated testing and packaging your project" href="lecture11_continuous_integration_and_packaging_projects.html" />
    <link rel="prev" title="HW5, practice material from the “Whirlwind Tour of Python”" href="HW05.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="lecture11_continuous_integration_and_packaging_projects.html" title="11) Automated testing and packaging your project"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="HW05.html" title="HW5, practice material from the “Whirlwind Tour of Python”"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CHE 696: On-Ramp to Data Science 0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="HW05.html"
                        title="previous chapter">HW5, practice material from the “Whirlwind Tour of Python”</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="lecture11_continuous_integration_and_packaging_projects.html"
                        title="next chapter">11) Automated testing and packaging your project</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="section" id="10)-Writing-unit-tests-and-running-from-anywhere-on-your-machine">
<h1>10) Writing unit tests and running from anywhere on your machine<a class="headerlink" href="#10)-Writing-unit-tests-and-running-from-anywhere-on-your-machine" title="Permalink to this headline">¶</a></h1>
<p>Related references:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python-guide.org/writing/tests/">https://docs.python-guide.org/writing/tests/</a></li>
<li><a class="reference external" href="https://jeffknupp.com/blog/2013/12/09/improve-your-python-understanding-unit-testing/">https://jeffknupp.com/blog/2013/12/09/improve-your-python-understanding-unit-testing/</a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/unittest.html">https://docs.python.org/3/library/unittest.html</a></li>
</ul>
<p>We always want to test that our program works. Last time, we did that
manually–I looked at the output and saw it was what I expected and
wanted. We also talked about the need to automate tests, so we can be
sure that, as we add more functionality, we don’t accidentally break
something. This will also allow us to check that our program behaves as
desired on multiple architectures. Today, we’ll discuss how to do so.</p>
<p>Writing tests for Python is much like writing tests for your own code.
Tests need to be thorough, fast, isolated, consistently repeatable, and
as simple as possible. We try to have tests both for normal behavior and
for error conditions. Tests live in the <code class="docutils literal notranslate"><span class="pre">tests</span></code> directory, where every
file that includes tests has a <code class="docutils literal notranslate"><span class="pre">test_</span></code> prefix.</p>
<div class="section" id="What-is-meant-by-unit-testing?">
<h2>What is meant by unit testing?<a class="headerlink" href="#What-is-meant-by-unit-testing?" title="Permalink to this headline">¶</a></h2>
<p>It is testing small units of code, e.g.&nbsp;individual functions, to help
isolate the location of the error.</p>
<p>In addition, I always test the “main” function to make sure individual
units connect correctly.</p>
<p><code class="docutils literal notranslate"><span class="pre">unittest</span></code> is also a test module in the Python standard library.
Creating test cases is accomplished by subclassing unittest.TestCase
(see below)</p>
</div>
<div class="section" id="Examples-of-types-of-errors-to-look-for">
<h2>Examples of types of errors to look for<a class="headerlink" href="#Examples-of-types-of-errors-to-look-for" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><em>Syntax errors</em>: often checks that the user typed in a valid
argument, and gives a useful error message if such a mistake is
caught.</li>
<li><em>Logical errors</em>: when the algorithm used is not correct (either
originally, or error created upon later editing of the code)</li>
<li><em>Unexpected input/edge cases</em>: e.g.&nbsp;a program is only meant to work
with positive values (e.g.&nbsp;a zero is entered and a log will be taken)</li>
</ol>
<p>What type of error does the test below check for?</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># A very basic unittest</span>

<span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">class</span> <span class="nc">MyTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fun</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The heart of the test is the assertion step at the end. There are many
options, more even than those listed below. There are further notes on
how all the following work at
<a class="reference external" href="https://docs.python.org/3/library/unittest.html">https://docs.python.org/3/library/unittest.html</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Checks that</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>assertEqual(a,
b)</td>
<td>a == b</td>
</tr>
<tr class="row-odd"><td>assertNotEqual(
a,
b)</td>
<td>a != b</td>
</tr>
<tr class="row-even"><td>assertTrue(x)</td>
<td>bool(x) is True</td>
</tr>
<tr class="row-odd"><td>assertFalse(x)</td>
<td>bool(x) is False</td>
</tr>
<tr class="row-even"><td>assertIs(a, b)</td>
<td>a is b</td>
</tr>
<tr class="row-odd"><td>assertIsNot(a,
b)</td>
<td>a is not b</td>
</tr>
<tr class="row-even"><td>assertIsNone(x)</td>
<td>x is None</td>
</tr>
<tr class="row-odd"><td>assertIsNotNone
(x)</td>
<td>x is not None</td>
</tr>
<tr class="row-even"><td>assertIn(a, b)</td>
<td>a in b</td>
</tr>
<tr class="row-odd"><td>assertNotIn(a,
b)</td>
<td>a not in b</td>
</tr>
<tr class="row-even"><td>assertAlmostEqu
al(a,
b)</td>
<td>round(a-b, 7) == 0</td>
</tr>
<tr class="row-odd"><td>assertNotAlmost
Equal(a,
b)</td>
<td>round(a-b, 7) != 0</td>
</tr>
<tr class="row-even"><td>assertGreater(a
,
b)</td>
<td>a &gt; b</td>
</tr>
<tr class="row-odd"><td>assertGreaterEq
ual(a,
b)</td>
<td>a &gt;= b</td>
</tr>
<tr class="row-even"><td>assertLess(a,
b)</td>
<td>a &lt; b</td>
</tr>
<tr class="row-odd"><td>assertLessEqual
(a,
b)</td>
<td>a &lt;= b</td>
</tr>
<tr class="row-even"><td>assertCountEqua
l(a,
b)</td>
<td>a and b have the same elements in the same number,
regardless of their order</td>
</tr>
</tbody>
</table>
<p>Generally, the functions we are testing will be in a different file than
the tests. I’ve set up tests for our sample arthritis project
(<a class="reference external" href="https://github.com/team-mayes/arthritis_proj_demo">https://github.com/team-mayes/arthritis_proj_demo</a>). Let’s walk through
those tests to get a feel for the types of tests we want to make.</p>
<p>First, note that I’ve reorganized my folders a little bit, separating
out <code class="docutils literal notranslate"><span class="pre">tests</span></code> and making a subfolder with files for testing the script
<code class="docutils literal notranslate"><span class="pre">data_proc.py</span></code>. I like to have a separate test for each script, and a
separate folder for files for testing that script.</p>
<div class="figure" id="id1">
<img alt="Screen shot" src="../_images/lect10_reorg.png" />
<p class="caption"><span class="caption-text">Screen shot</span></p>
</div>
<p>Now let’s look at <code class="docutils literal notranslate"><span class="pre">test_data_proc.py</span></code>. As usual, the beginning
includes imports of libraries. Not that we have to import the script
that we want to test.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Unit and regression test for data_proc.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">arthritis_proj.data_proc</span> <span class="kn">import</span> <span class="n">main</span><span class="p">,</span> <span class="n">data_analysis</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">logging</span></code> library is helpful to log or perform certain actions
only under certain conditions. You’ll see how this is used in the tests
below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># logging.basicConfig(level=logging.DEBUG)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">DISABLE_REMOVE</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To refer to where particular files are, we want to use relative paths
only, as we want these tests to work on many diffrent machines. What do
you think the following lines do?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">CURRENT_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
<span class="n">MAIN_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CURRENT_DIR</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>
<span class="n">TEST_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CURRENT_DIR</span><span class="p">,</span> <span class="s1">&#39;data_proc&#39;</span><span class="p">)</span>
<span class="n">PROJ_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MAIN_DIR</span><span class="p">,</span> <span class="s1">&#39;arthritis_proj&#39;</span><span class="p">)</span>
<span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PROJ_DIR</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">SAMPLE_DATA_FILE_LOC</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;sample_data.csv&#39;</span><span class="p">)</span>

<span class="c1"># Assumes running tests from the main directory</span>
<span class="n">DEF_CSV_OUT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MAIN_DIR</span><span class="p">,</span> <span class="s1">&#39;sample_data_stats.csv&#39;</span><span class="p">)</span>
<span class="n">DEF_PNG_OUT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MAIN_DIR</span><span class="p">,</span> <span class="s1">&#39;sample_data_stats.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-4-eee6dc89282f&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>CURRENT_DIR <span class="ansi-blue-fg">=</span> os<span class="ansi-blue-fg">.</span>path<span class="ansi-blue-fg">.</span>dirname<span class="ansi-blue-fg">(</span>__file__<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> MAIN_DIR <span class="ansi-blue-fg">=</span> os<span class="ansi-blue-fg">.</span>path<span class="ansi-blue-fg">.</span>join<span class="ansi-blue-fg">(</span>CURRENT_DIR<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;..&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> TEST_DATA_DIR <span class="ansi-blue-fg">=</span> os<span class="ansi-blue-fg">.</span>path<span class="ansi-blue-fg">.</span>join<span class="ansi-blue-fg">(</span>CURRENT_DIR<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;data_proc&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> PROJ_DIR <span class="ansi-blue-fg">=</span> os<span class="ansi-blue-fg">.</span>path<span class="ansi-blue-fg">.</span>join<span class="ansi-blue-fg">(</span>MAIN_DIR<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;arthritis_proj&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> DATA_DIR <span class="ansi-blue-fg">=</span> os<span class="ansi-blue-fg">.</span>path<span class="ansi-blue-fg">.</span>join<span class="ansi-blue-fg">(</span>PROJ_DIR<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;data&#39;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;__file__&#39; is not defined
</pre></div></div>
</div>
<p>That does it for our preamble. Now I’ve defined a helper function that
will be used by the tests below it. (FYI, as described on
<a class="reference external" href="https://docs.python.org/3/library/errno.html">https://docs.python.org/3/library/errno.html</a>, <code class="docutils literal notranslate"><span class="pre">errno.ENOENT</span></code> is a
standard error message that means <code class="docutils literal notranslate"><span class="pre">No</span> <span class="pre">such</span> <span class="pre">file</span> <span class="pre">or</span> <span class="pre">directory</span></code>. Any
questions on what this function does?</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">silent_remove</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes the target file name, catching and ignoring errors that indicate that the</span>
<span class="sd">    file does not exist.</span>

<span class="sd">    @param filename: The file to remove.</span>
<span class="sd">    @param disable: boolean to flag if want to disable removal</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">disable</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">:</span>
                <span class="k">raise</span>

</pre></div>
</div>
</div>
<p>Now let’s get to the tests themselves, going through each line to see
what they do:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">TestMain</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c1"># These tests make sure that the program can run properly from main</span>
    <span class="k">def</span> <span class="nf">testSampleData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Checks that runs with defaults and that files are created</span>
        <span class="n">test_input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">DEFAULT_DATA_FILE_LOC</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
                <span class="n">main</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span>
            <span class="c1"># checks that the expected message is sent to standard out</span>
            <span class="k">with</span> <span class="n">capture_stdout</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">test_input</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;sample_data_stats.csv&quot;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;sample_data_stats.csv&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;sample_data_stats.png&quot;</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">silent_remove</span><span class="p">(</span><span class="n">DEF_CSV_OUT</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="n">DISABLE_REMOVE</span><span class="p">)</span>
            <span class="n">silent_remove</span><span class="p">(</span><span class="n">DEF_PNG_OUT</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="n">DISABLE_REMOVE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TestMainFailWell</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">testMissingFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">test_input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;ghost.txt&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
            <span class="n">main</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">capture_stderr</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">test_input</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;ghost.txt&quot;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">capture_stdout</span></code> and <code class="docutils literal notranslate"><span class="pre">capture_stderr</span></code> called functions at the bottom
of the file. Don’t worry about understanding each line of the bellow.
The main point is that these allow any messages sent to standard out or
standard error, respectively, to be captured as strings.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Utility functions</span>

<span class="c1"># From http://schinckel.net/2013/04/15/capture-and-test-sys.stdout-sys.stderr-in-unittest.testcase/</span>
<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">capture_stdout</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># pycharm doesn&#39;t know six very well, so ignore the false warning</span>
    <span class="c1"># noinspection PyCallingNonCallable</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="n">command</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">out</span>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">capture_stderr</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># pycharm doesn&#39;t know six very well, so ignore the false warning</span>
    <span class="c1"># noinspection PyCallingNonCallable</span>
    <span class="n">err</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="n">command</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">err</span>

</pre></div>
</div>
</div>
<p>Separately, the tests below checked that the function
<code class="docutils literal notranslate"><span class="pre">data_analysis()</span></code> behaves as expected.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">TestDataAnalysis</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">testSampleData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Tests that the np array generated by the data_analysis function matches saved expected results</span>
        <span class="n">csv_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">SAMPLE_DATA_FILE_LOC</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">analysis_results</span> <span class="o">=</span> <span class="n">data_analysis</span><span class="p">(</span><span class="n">csv_data</span><span class="p">)</span>
        <span class="n">expected_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEST_DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;sample_data_results.csv&quot;</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">expected_results</span><span class="p">,</span> <span class="n">analysis_results</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">testSampleData2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A second check, with slightly different values, of the data_analysis function</span>
        <span class="n">csv_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEST_DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;sample_data2.csv&quot;</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">analysis_results</span> <span class="o">=</span> <span class="n">data_analysis</span><span class="p">(</span><span class="n">csv_data</span><span class="p">)</span>
        <span class="n">expected_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEST_DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;sample_data2_results.csv&quot;</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">expected_results</span><span class="p">,</span> <span class="n">analysis_results</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Let’s add another test together. I want to see what happens if I have
different number of days of data for different patients. I started with
a new file () in which I deleted some days of data from patients 2 and
three (want to see what is different? Do a file compare!).</p>
<div class="figure" id="id2">
<img alt="Screen shot" src="../_images/lect10_missing-cols.png" />
<p class="caption"><span class="caption-text">Screen shot</span></p>
</div>
<p>Now let’s see what happens when we run this, which I will do from the
beginnings of a new test. Note that I moved a test into a new class. I
do this to help people who might use my tests to figure out how to run
the program.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">TestMainBadInput</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">testMissingFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">test_input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;ghost.txt&quot;</span><span class="p">]</span>
        <span class="n">main</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">capture_stderr</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">test_input</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;ghost.txt&quot;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testDataDiffNumCols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">input_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEST_DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;sample_data3_diff_cols.csv&quot;</span><span class="p">)</span>
        <span class="n">test_input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">input_file</span><span class="p">]</span>
        <span class="n">main</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Running <code class="docutils literal notranslate"><span class="pre">testDataDiffNumCols</span></code>, I get the following error:</p>
<div class="figure" id="id3">
<img alt="Screen shot" src="../_images/lect10_error.png" />
<p class="caption"><span class="caption-text">Screen shot</span></p>
</div>
<p>I’ll take this information, specifically the type of error that I’m
getting, and do a try-catch loop for this error. I know that this
problem happens in line 67 of data_proc.py, so I’ll go there (by
clicking on the link) to see where I can catch this exception.</p>
<div class="figure" id="id4">
<img alt="Screen shot" src="../_images/lect10_error-loc.png" />
<p class="caption"><span class="caption-text">Screen shot</span></p>
</div>
<p>We are already in a try-catch loop, but it only caught an <code class="docutils literal notranslate"><span class="pre">IOError</span></code>.
We now can add the so I’ll add the <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">parse_cmdline</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the parsed argument list and return code.</span>
<span class="sd">    `argv` is a list of arguments, or `None` for ``sys.argv[1:]``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="c1"># initialize the parser object:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;--csv_data_file&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The location (directory and file name) of the csv file with &quot;</span>
                                                      <span class="s2">&quot;data to analyze&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">DEFAULT_DATA_FILE_LOC</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">csv_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">csv_data_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Problems reading file:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">args</span><span class="p">,</span> <span class="n">IO_ERROR</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Read invalid data:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">args</span><span class="p">,</span> <span class="n">INVALID_DATA</span>

    <span class="k">return</span> <span class="n">args</span><span class="p">,</span> <span class="n">SUCCESS</span>
</pre></div>
</div>
</div>
<p>Let’s try running our test again.</p>
<div class="figure" id="id5">
<img alt="Screen shot" src="../_images/lect10_no-asserts.png" />
<p class="caption"><span class="caption-text">Screen shot</span></p>
</div>
<p>Now we get the behavior we want, but we are not yet actually testing
anything with an assert statement. Let’s do that by checking that we get
the error we expect. <em>FYI</em>: I added a clause that the program will be
run on its own only if the debugger is on, but we are not getting
anything from running it without capturing an error message that we will
use for testing. It can be nice to see the whole output message, which
we would get if we have make the debugging mode active.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">TestMainFailWell</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">testMissingFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">test_input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;ghost.txt&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
            <span class="n">main</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">capture_stderr</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">test_input</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;ghost.txt&quot;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testDataDiffNumCols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">input_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEST_DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;sample_data3_diff_cols.csv&quot;</span><span class="p">)</span>
        <span class="n">test_input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">input_file</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
            <span class="n">main</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">capture_stderr</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">test_input</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s2">&quot;Wrong number of columns&quot;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Some-best-practices-in-writing-tests">
<h2>Some best practices in writing tests<a class="headerlink" href="#Some-best-practices-in-writing-tests" title="Permalink to this headline">¶</a></h2>
<p>(from <a class="reference external" href="https://docs.python-guide.org/writing/tests/">https://docs.python-guide.org/writing/tests/</a>)</p>
<ul class="simple">
<li>A testing unit should focus on one tiny bit of functionality and
prove it correct.</li>
<li>Each test unit must be fully independent. Each test must be able to
run alone, and also within the test suite, regardless of the order
that they are called. The implication of this rule is that each test
must be loaded with a fresh dataset and may have to do some cleanup
afterwards.</li>
<li>Try hard to make tests that run fast. If one single test needs more
than a few milliseconds to run, development will be slowed down or
the tests will not be run as often as is desirable. In some cases,
tests can’t be fast because they need a complex data structure to
work on, and this data structure must be loaded every time the test
runs. Keep these heavier tests in a separate test suite that is run
by some scheduled task, and run all other tests as often as needed.
Use small versions of data and files to be tested to keep things
fast.</li>
<li>Learn your tools and learn how to run a single test or a test case.
Then, when developing a function inside a module, run this function’s
tests frequently, ideally automatically when you save the code.</li>
<li>Always run the full test suite before a coding session, and run it
again after. This will give you more confidence that you did not
break anything in the rest of the code.</li>
<li>It is a good idea to implement a hook that runs all tests before
pushing code to a shared repository.</li>
<li>If you are in the middle of a development session and have to
interrupt your work, it is a good idea to write a broken unit test
about what you want to develop next. When coming back to work, you
will have a pointer to where you were and get back on track faster.</li>
<li>The first step when you are debugging your code is to write a new
test pinpointing the bug. While it is not always possible to do,
those bug catching tests are among the most valuable pieces of code
in your project.</li>
<li>Use long and descriptive names for testing functions. The style guide
here is slightly different than that of running code, where short
names are often preferred. The reason is testing functions are never
called explicitly. square() or even sqr() is ok in running code, but
in testing code you would have names such as testSquareOfNumber2(),
testSquareNegativeNumber(). These function names are displayed when a
test fails, and should be as descriptive as possible.</li>
<li>When something goes wrong or has to be changed, and if your code has
a good set of tests, you or other maintainers will rely largely on
the testing suite to fix the problem or modify a given behavior.
Therefore the testing code will be read as much as or even more than
the running code. A unit test whose purpose is unclear is not very
helpful in this case.</li>
<li>Another use of the testing code is as an introduction to new
developers. When someone will have to work on the code base, running
and reading the related testing code is often the best thing that
they can do to start. They will or should discover the hot spots,
where most difficulties arise, and the corner cases. If they have to
add some functionality, the first step should be to add a test to
ensure that the new functionality is not already a working path that
has not been plugged into the interface.</li>
</ul>
</div>
<div class="section" id="Next-steps">
<h2>Next steps<a class="headerlink" href="#Next-steps" title="Permalink to this headline">¶</a></h2>
<p>Start thinking about your project. I encourage discussion with me about
what you might want to do and how to accomplish it. I will be posting
some more examples to help you with the project; knowing what kinds of
tasks you want to accomplish will help me set up useful examples for
you.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="lecture11_continuous_integration_and_packaging_projects.html" title="11) Automated testing and packaging your project"
             >next</a> |</li>
        <li class="right" >
          <a href="HW05.html" title="HW5, practice material from the “Whirlwind Tour of Python”"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CHE 696: On-Ramp to Data Science 0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Heather Mayes.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  </body>
</html>